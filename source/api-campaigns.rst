.. _api-campaigns:

Campaigns
=========

Unlike other email platforms Mailgun analytics is not limited to campaigns sent
to the mailing lists. You can generate powerful reports and analytize data for
any subset of your email traffic: just create an email campaign and specify that
campaign's ID when sending a message.

Below is the list of API calls for managing your campaigns and retreiving reports
programmatically.

.. code-block:: url

     GET /<domain>/campaigns

Returns the list of the campaigns created for a given domain.

.. container:: ptable

 ================ =========================================================
 Parameter        Description
 ================ =========================================================
 limit            Maximum number of records to return (100 by default).
                  *(optional)*
 skip             Number of records to skip (0 by default). *(optional)*
 ================ =========================================================

.. code-block:: url

     GET /<domain>/campaigns/<id>

Returns a single campaign for a given domain.

.. code-block:: url

     POST /<domain>/campaigns

Creates a new campaign under a given domain.
Note, that it will not create a new campaign, if the limit for account is
reached - old campaigns must be deleted first.

.. container:: ptable

 ================ =========================================================
 Parameter        Description
 ================ =========================================================
 name             Name of the new campaign
 id               Identifier to assign to this campaign. Will be
                  autogenerated, if not provided. *(optional)*
 ================ =========================================================

.. note:: Supplied ``id`` must be pure ASCII and unique across all campaigns
          for a particular domain. Campaign name and campaign ID should not exceed the
          maximum length of 64 characters.

.. code-block:: url

     PUT /<domain>/campaigns/<id>

Updates existing campaign with a new name and/or new id.

.. container:: ptable

 ================ =========================================================
 Parameter        Description
 ================ =========================================================
 name             New name to assign to the campaign. *(optional)*
 id               New identifier to assign to the campaign. *(optional)*
 ================ =========================================================

.. note:: Supplied ``id`` must be pure ASCII and unique across all campaigns
          for a particular domain. Campaign name and campaign ID should not exceed the
          maximum length of 64 characters.

.. code-block:: url

     DELETE /<domain>/campaigns/<id>

Deletes the given campaign **with all its data**.

Events
------

Campaign events include clicks, opens, unsubscribes, bounces and complaints for
all receipients of the messages along with their region, country, etc.

The Campaign Events API allows you to retrieve the raw list of all message events
for a given campaign to generate custom reports.

.. code-block:: url

     GET /<domain>/campaigns/<id>/events

Fetches the list of recently happened events for a given campaign.

.. container:: ptable

 ==================== =====================================================
 Parameter            Description
 ==================== =====================================================
 event                Name of event to filter by - ``clicked``, ``opened``,
                      ``unsubscribed``, ``bounced``, ``complained``.
                      *(optional)*
 recipient            Address of recipient to filter by. *(optional)*
 country              Two-letters country code to filter by. For example:
                      US, RU. *(optional)*
 region               Name or code of region to filter by. For example, US
                      states: CA, OH. *(optional)*
 limit                Maximum number of records to return (100 at most).
                      *(optional)*
 page                 Number of page to retrieve. *(optional)*
 count                Toggles whether to return actual data or just count of
                      records. *(optional)*
 ==================== =====================================================

.. note:: Filters can be chained. For example, if you want to retrieve
          events data for clicks and opens for a particular recipient, you
          can pass ``event=clicked&event=opened&recipient=user@domain.com``.

.. note:: 'Delivered' events are stored for 2 weeks only.

Stats
-----

Campaign Stats API allows you to retrieve a campaign performance reports
similar to what you can see in the Control Panel.

.. code-block:: url

     GET /<domain>/campaigns/<id>/stats

Fetches a summary of the results for a given campaign, like numbers of
clicks, opens, etc. Includes unique numbers (for example, number of unique
recipients who clicked) as well.

.. container:: ptable

 ================== =======================================================
 Parameter          Description
 ================== =======================================================
 groupby            Grouping parameter - ``domain`` or ``daily_hour``.
                    *(optional)*
 ================== =======================================================

.. _daily-hour-note:

.. note:: Parameter ``daily_hour`` means that grouping performed only by
          hours, excluding day info.

Clicks
------

Aggregated clicks statistics for a campaign.

.. code-block:: url

     GET /<domain>/campaigns/<id>/clicks

Fetches clicks data aggregated by one or more parameters (ordered by
totals).

.. container:: ptable

 ==================== =====================================================
 Parameter            Description
 ==================== =====================================================
 groupby              Grouping parameter - ``link``, ``recipient``,
                      ``domain``, ``country``, ``region``, ``city``,
                      ``month``, ``day``, ``hour``, ``minute``,
                      ``daily_hour``.
 country              Two-digit country code to filter by. *(optional)*
 region               Name or code of region to filter by. For example, US
                      states: CA, OH. *(optional)*
 city                 Name of the city to filter by. For example, Chicago.
                      *(optional)*
 limit                Maximum number of records to return (100 at most).
                      *(optional)*
 page                 Number of page to retrieve. *(optional)*
 count                Toggles whether to return actual data or just count of
                      records. *(optional)*
 ==================== =====================================================

Opens
-----

Aggregated opens statistics for a campaign.

.. code-block:: url

     GET /<domain>/campaigns/<id>/opens

Fetches opens data aggregated by one or more parameters (ordered by totals).

.. container:: ptable

 ==================== =====================================================
 Parameter            Description
 ==================== =====================================================
 groupby              Grouping parameter - ``recipient``, ``domain``,
                      ``country``, ``region``, ``city``, ``month``, ``day``,
                      ``hour``, ``minute``, ``daily_hour``.
 country              Two-digit country code to filter by. *(optional)*
 region               Name or code of region to filter by. For example, US
                      states: CA, OH. *(optional)*
 city                 Name of the city to filter by. For example, Chicago.
                      *(optional)*
 limit                Maximum number of records to return (100 at most).
                      *(optional)*
 page                 Number of page to retrieve. *(optional)*
 count                Toggles whether to return actual data or just count of
                      records. *(optional)*
 ==================== =====================================================

Unsubscribes
------------

Aggregated unsubscribes statistics for a campaign.

.. code-block:: url

     GET /<domain>/campaigns/<id>/unsubscribes

Fetches unsubscribes data aggregated by one or more parameters (ordered by
totals).

.. container:: ptable

 ==================== =====================================================
 Parameter            Description
 ==================== =====================================================
 groupby              Aggregation parameter - ``domain``, ``country``,
                      ``region``, ``city``, ``month``, ``day``, ``hour``,
                      ``minute``, ``daily_hour``.
 country              Two-digit country code to filter by. *(optional)*
 region               Name or code of region to filter by. For example, US
                      states: CA, OH. *(optional)*
 city                 Name of the city to filter by. For example, Chicago.
                      *(optional)*
 limit                Maximum number of records to return (100 at most).
                      *(optional)*
 page                 Number of page to retrieve. *(optional)*
 count                Toggles whether to return actual data or just count of
                      records. *(optional)*
 ==================== =====================================================

Complaints
----------

Aggregated complaints statistics for a campaign.

.. code-block:: url

     GET /<domain>/campaigns/<id>/complaints

Fetches complaints data aggregated by one or more parameters (ordered by
totals).

.. container:: ptable

 ==================== =====================================================
 Parameter            Description
 ==================== =====================================================
 groupby              Aggregation parameter - ``recipient``, ``domain``,
                      ``month``, ``day``, ``hour``, ``minute``,
                      ``daily_hour``.
 limit                Maximum number of records to return (100 at most).
                      *(optional)*
 page                 Number of page to retrieve. *(optional)*
 count                Toggles whether to return actual data or just count of
                      records. *(optional)*
 ==================== =====================================================

Basic Examples
--------------

Retrieve all campaigns for a domain:

.. include:: samples/get-campaigns.rst

Sample response:

.. code-block:: javascript

  {
    "total_count": 1,
    "items": [
        {
            "delivered_count": 924,
            "name": "Sample",
            "created_at": "Wed, 15 Feb 2012 11:31:17 GMT",
            "clicked_count": 135,
            "opened_count": 301,
            "submitted_count": 998,
            "unsubscribed_count": 44,
            "bounced_count": 20,
            "complained_count": 3,
            "id": "1",
            "dropped_count": 13
        }
    ]
  }

Retrieve events history for a campaign:

.. include:: samples/get-campaign-events.rst

Sample response:

.. code-block:: javascript

  [
    {
        "domain": "mailgun.net",
        "tags": [],
        "timestamp": "Wed, 15 Feb 2012 12:58:21 GMT",
        "recipient": "baz@example.com",
        "event": "delivered",
        "user_vars": {}
    },
    {
        "domain": "mailgun.net",
        "tags": [],
        "timestamp": "Wed, 15 Feb 2012 12:55:15 GMT",
        "recipient": "baz@example.com",
        "event": "delivered",
        "user_vars": {}
    }
  ]

Retrieve general stats for your campaign:

.. include:: samples/get-campaign-stats.rst

Sample response:

.. code-block:: javascript

  {
    "unique": {
        "clicked": {
            "link": 3,
            "recipient": 3
        },
        "opened": {
            "recipient": 3
        }
    },
    "total": {
        "complained": 0,
        "delivered": 67,
        "clicked": 6,
        "opened": 7,
        "dropped": 0,
        "bounced": 0,
        "sent": 67,
        "unsubscribed": 5
    }
  }

Retrieve list of people who clicked (recipients who clicked the most come first):

.. include:: samples/get-campaign-recipients-who-clicked.rst

Sample response:

.. code-block:: javascript

  [
    {
        "total": 3,
        "unique": {
            "link": 3
        },
        "recipient": "alice@example.com"
    },
    {
        "total": 2,
        "unique": {
            "link": 2
        },
        "recipient": "foo@example.com"
    }
  ]

Advanced Examples
-----------------

See your recipients activity during daily hours:

.. code-block:: url

 GET /<domain>/campaigns/<id>/stats?groupby=daily_hour

If your campaign's recipients located in various regions (cities), you can
see how're different regions (cities) performing in general:

.. code-block:: url

 GET /<domain>/campaigns/<id>/stats?groupby=city

.. code-block:: url

 GET /<domain>/campaigns/<id>/stats?groupby=region

After determining the most performant region (city) you can get detailed
statistics for it. For example, see recipients who opened your email in Chicago:

.. code-block:: url

 GET /<domain>/campaigns/<id>/opens?groupby=recipient&city=Chicago

Retrieve top 10 countries in which your campaign has been opened the most (of
course, it is perfectly fine to replace 'country' with 'region' or 'city'):

.. code-block:: url

 GET /<domain>/campaigns/<id>/opens?groupby=country&limit=10

Probably you want to know what is the most popular link in your campaign. It is
as easy as:

.. code-block:: url

 GET /<domain>/campaigns/<id>/clicks?groupby=link

You can even turn 'spy mode' on and see who clicked which link:

.. code-block:: url

 GET /<domain>/campaigns/<id>/clicks?groupby=link&groupby=recipient
